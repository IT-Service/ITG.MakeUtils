%!PS-Adobe-2.0
%%Creator: Sergei S. Betke
%%EndComments

/GetPageBBox {
  currentpagedevice /ImagingBBox get
  dup type /nulltype eq
    {
      pop
        0 0
        currentpagedevice /PageSize get  aload  pop
        4 array
      astore
    }
  if
}
def

/rotate_to_zero
{
  matrix currentmatrix
  aload pop pop pop pop pop % --> a b
  exch % --> b a
  atan % угол поворота исходной матрицы
  neg rotate % развернули исходную матрицу, чтобы исключить поворот
} def

/size_of_BBox % [ x1 y1 x2 y2 ] --> x2-x1  y2-y1
{
  dup type  /arraytype  eq  { aload pop } if
  exch  3 1 roll
  sub neg
  3 1 roll
  sub neg
  exch
} bind def

/size_of_BBox_def % /sizeX /sizeY [ x1 y1 x2 y2 ] --> - ; /sizeX = x2-x1; /sizeY = y2-y1;
{
  size_of_BBox
  3 -1 roll exch def
  def
} def

/upath_BBox % upath --> x1 y1 x2 y2
{
  matrix currentmatrix
    rotate_to_zero
    exch % upath
    gsave
      newpath
      0 0 moveto
      uappend flattenpath pathbbox
    grestore
    5 -1 roll
  setmatrix
} bind def

/string_BBox % string --> x1 y1 x2 y2
{
  matrix currentmatrix
    rotate_to_zero
    exch % string
    gsave
      newpath
      0 0 moveto
      false charpath pathbbox
    grestore
    5 -1 roll
  setmatrix
} bind def

%%EOF
